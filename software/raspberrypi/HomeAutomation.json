[{"id":"3405a891.bc91d8","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"93fac854.95b55","type":"inject","z":"3405a891.bc91d8","name":"","topic":"","payload":"20;8;Kaku;ID=14;SWITCH=1;CMD=015491","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":180,"wires":[["fa1fe2f6.bdaf88"]]},{"id":"fa1fe2f6.bdaf88","type":"function","z":"3405a891.bc91d8","name":"parse serial","func":"//20;14;Kaku;ID=20;SWITCH=1;CMD=01548F\nif (msg.payload.length>14 && msg.payload.length<60){\n    \n\nvar output = msg.payload.split(\";\");\nvar output1 = parseInt(output[3].slice(3), 16);\nvar output2 = parseInt(output[5].slice(4,6), 16);\nvar output3 = parseInt(output[5].slice(6,8), 16);\nvar output4 = parseInt(output[5].slice(8,10), 16)*0.2 -10.0;\nvar output5 = new Date();//.toLocaleString();\n\n\n\n  //msg.payload = [output1,output2,output3,output4];\n  msg.payload = { \"id\": output1, \"status\": output2, \"battery\": output3, \"temperature\": output4, \"lastSeen\": output5 };\n\n  return msg;\n}\n  \n","outputs":1,"noerr":0,"x":310,"y":180,"wires":[["15761a7.4e47566"]]},{"id":"8e14f8d8.b7d1f8","type":"debug","z":"3405a891.bc91d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":80,"wires":[]},{"id":"9110b04c.139de","type":"serial in","z":"3405a891.bc91d8","name":"","serial":"b4cdcf58.df6728","x":110,"y":300,"wires":[["b00d4105.016bf","fa1fe2f6.bdaf88"]]},{"id":"b00d4105.016bf","type":"debug","z":"3405a891.bc91d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":290,"y":300,"wires":[]},{"id":"d460546.5e260a8","type":"serial out","z":"3405a891.bc91d8","name":"","serial":"b4cdcf58.df6728","x":870,"y":420,"wires":[]},{"id":"dccabe9c.55ed2","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Volet 1","tooltip":"","place":"","group":"779970f0.f44b78","order":0,"width":0,"height":0,"passthru":true,"options":[{"label":"Open","value":"10;X10;000041;1;UP","type":"str"},{"label":"Close","value":"10;X10;000041;1;DOWN","type":"str"},{"label":"Stop","value":"10;X10;000041;1;STOP","type":"str"}],"payload":"","topic":"","x":550,"y":480,"wires":[["d460546.5e260a8"]]},{"id":"6f232e87.0fa05","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Volet 2","tooltip":"","place":"","group":"779970f0.f44b78","order":0,"width":0,"height":0,"passthru":true,"options":[{"label":"Open","value":"10;X10;000041;2;UP","type":"str"},{"label":"Close","value":"10;X10;000041;2;DOWN","type":"str"},{"label":"Stop","value":"10;X10;000041;2;STOP","type":"str"}],"payload":"","topic":"","x":548.0833282470703,"y":530,"wires":[["d460546.5e260a8"]]},{"id":"e7a6b42a.bc57f8","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Volet 3","tooltip":"","place":"","group":"779970f0.f44b78","order":0,"width":0,"height":0,"passthru":true,"options":[{"label":"Open","value":"10;X10;000041;3;UP","type":"str"},{"label":"Close","value":"10;X10;000041;3;DOWN","type":"str"},{"label":"Stop","value":"10;X10;000041;3;STOP","type":"str"}],"payload":"","topic":"","x":550,"y":580,"wires":[["d460546.5e260a8"]]},{"id":"e4d8e6f8.15c258","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Volets","tooltip":"","place":"","group":"779970f0.f44b78","order":0,"width":0,"height":0,"passthru":true,"options":[{"label":"Open","value":"10;X10;000041;a;UP","type":"str"},{"label":"Close","value":"10;X10;000041;a;DOWN","type":"str"},{"label":"Stop","value":"10;X10;000041;a;STOP","type":"str"}],"payload":"","topic":"","x":550,"y":420,"wires":[["d460546.5e260a8"]]},{"id":"23a1dc4a.d7018c","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Lumière Salon","tooltip":"","place":"","group":"16b61bf9.538b74","order":0,"width":0,"height":0,"passthru":true,"options":[{"label":"On","value":"10;HomeEasy;B6E3F2;2;ON","type":"str"},{"label":"Off","value":"10;HomeEasy;B6E3F2;2;OFF","type":"str"}],"payload":"","topic":"","x":580,"y":640,"wires":[["d460546.5e260a8"]]},{"id":"4ca3afd7.2f1208","type":"function","z":"3405a891.bc91d8","name":"save in context","func":"if (msg.payload.name == \"escalier_p\"){\n    global.set('escalier_p', msg.payload)\n}\nif (msg.payload.name == \"veranda_d\"){\n    global.set('veranda_d', msg.payload)\n}\nif (msg.payload.name == \"buanderie_d\"){\n    global.set('buanderie_d', msg.payload)\n}\nif (msg.payload.name == \"cuisine_w\"){\n    global.set('cuisine_w', msg.payload)\n}\nif (msg.payload.name == \"salon_p\"){\n    global.set('salon_p', msg.payload)\n}\nif (msg.payload.name == \"cuisine_p\"){\n    global.set('cuisine_p', msg.payload)\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":180,"wires":[["96f316ed.63e0f","30a8aec8.aa222a","6f4d691e.93e34"]]},{"id":"21970f0e.967278","type":"ui_text","z":"3405a891.bc91d8","group":"7186e738.80d5a8","order":0,"width":0,"height":0,"name":"","label":"Température escalier","format":"{{msg.payload}}°C","layout":"row-spread","x":2000,"y":320,"wires":[]},{"id":"f705665c.ecce6","type":"ui_text","z":"3405a891.bc91d8","group":"4b6fffc4.5fd3c","order":0,"width":0,"height":0,"name":"","label":"Batterie escalier","format":"{{msg.payload}}%","layout":"row-spread","x":1980,"y":280,"wires":[]},{"id":"3d75af1b.b7294","type":"ui_text","z":"3405a891.bc91d8","group":"afedcbc7.da2c28","order":2,"width":0,"height":0,"name":"","label":"Porte Véranda","format":"{{msg.payload}}","layout":"row-spread","x":1980,"y":400,"wires":[]},{"id":"9359b312.5843e","type":"ui_text","z":"3405a891.bc91d8","group":"4b6fffc4.5fd3c","order":0,"width":0,"height":0,"name":"","label":"Batterie véranda","format":"{{msg.payload}}%","layout":"row-spread","x":1980,"y":440,"wires":[]},{"id":"a4ff3f07.daf11","type":"ui_text","z":"3405a891.bc91d8","group":"afedcbc7.da2c28","order":3,"width":0,"height":0,"name":"","label":"Porte Buanderie","format":"{{msg.payload}}","layout":"row-spread","x":1980,"y":600,"wires":[]},{"id":"c6ae1682.98c4c8","type":"ui_text","z":"3405a891.bc91d8","group":"afedcbc7.da2c28","order":4,"width":0,"height":0,"name":"","label":"Fenêtre Cuisine","format":"{{msg.payload}}","layout":"row-spread","x":1980,"y":500,"wires":[]},{"id":"ae44bd3b.b1532","type":"ui_text","z":"3405a891.bc91d8","group":"afedcbc7.da2c28","order":5,"width":0,"height":0,"name":"","label":"Présence salon","format":"{{msg.payload}}","layout":"row-spread","x":1980,"y":700,"wires":[]},{"id":"b3c037c4.d01f88","type":"function","z":"3405a891.bc91d8","name":"get from context","func":"msg.payload = global.get('escalier_p')\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":240,"wires":[["27ed0413.80175c","b01a6c43.340748","9f115b3e.62c778"]]},{"id":"ccfed5b8.506dd","type":"function","z":"3405a891.bc91d8","name":"get from context","func":"msg.payload = global.get('veranda_d')\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":400,"wires":[["da0d27fb.ab652","62cb32a5.c4457c"]]},{"id":"a40c997.43ee868","type":"function","z":"3405a891.bc91d8","name":"get from context","func":"msg.payload = global.get('cuisine_w')\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":500,"wires":[["2b53ba13.26e57e","4ebc4055.2945a8"]]},{"id":"e267fbd0.e6044","type":"function","z":"3405a891.bc91d8","name":"get from context","func":"msg.payload = global.get('buanderie_d')\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":600,"wires":[["39540257.76af1e","b322aca.90642d"]]},{"id":"e86fe16f.2740f","type":"function","z":"3405a891.bc91d8","name":"get from context","func":"msg.payload = global.get('salon_p')\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":700,"wires":[["be1cad6a.1aa228"]]},{"id":"b835a5f9.5c595","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Change","tooltip":"","place":"","group":"962067ca.77b198","order":3,"width":0,"height":0,"passthru":true,"options":[{"label":"Off","value":"Off","type":"str"},{"label":"Arm Away","value":"Arm Away","type":"str"},{"label":"Arm Home","value":"Arm Home","type":"str"}],"payload":"","topic":"","x":240,"y":960,"wires":[["88ae9138.122028"]]},{"id":"88ae9138.122028","type":"function","z":"3405a891.bc91d8","name":"","func":"global.set('_alarm_status',msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":960,"wires":[["20cedbc7.7b1224","cdb4a554.717748","c4f2e687.bba5d"]]},{"id":"c4f2e687.bba5d","type":"ui_text","z":"3405a891.bc91d8","group":"962067ca.77b198","order":2,"width":0,"height":0,"name":"","label":"Etat actuel","format":"{{msg.payload}}","layout":"row-spread","x":710,"y":920,"wires":[]},{"id":"59251f55.2226d8","type":"ui_text","z":"3405a891.bc91d8","group":"afedcbc7.da2c28","order":6,"width":0,"height":0,"name":"","label":"Présence escalier","format":"{{msg.payload}}","layout":"row-spread","x":1990,"y":240,"wires":[]},{"id":"c420094d.87431","type":"delay","z":"3405a891.bc91d8","name":"Auto off delay","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1120,"y":180,"wires":[["235e4f5d.d9ea08"]]},{"id":"5ab0dda7.7370bc","type":"function","z":"3405a891.bc91d8","name":"test alarm","func":"if (msg.payload.status == 1){\n    \n    var alarm_status = global.get('_alarm_status');\n    \n    if (alarm_status == \"Arm Away\"){\n    \n        if (msg.payload.name == \"veranda_d\"     || \n            msg.payload.name == \"cuisine_w\"     ||\n            msg.payload.name == \"cuisine_p\"    ||\n            msg.payload.name == \"buanderie_d\"   ||\n            msg.payload.name == \"escalier_p\"    ||\n            msg.payload.name == \"salon_p\") {\n            \n            global.set('_siren_status',1);\n            msg.payload = \"10;NewKaku;FFFFFF;1;ON\\r\\n\";\n            return msg;\n           \n        }\n    }\n    if (alarm_status == \"Arm Home\"){\n    \n        if (msg.payload.name == \"veranda_d\"     || \n            msg.payload.name == \"cuisine_w\"     ||\n            msg.payload.name == \"buanderie_d\") {\n            \n            global.set('_siren_status',1);\n            msg.payload = \"10;NewKaku;FFFFFF;1;ON\\r\\n\";\n            return msg;\n           \n        }\n    }\n\n}\n","outputs":1,"noerr":0,"x":730,"y":260,"wires":[["378ca616.eda6ea","406251b2.28bf5","b7508c1c.59364","73bcf58f.07da5c"]]},{"id":"15761a7.4e47566","type":"function","z":"3405a891.bc91d8","name":"add names","func":"var newMsg = msg;\nvar name=\"\";\n\nif (msg.payload.id == 0x14){\n    name = \"escalier_p\"\n}\nif (msg.payload.id == 0x10){\n    name = \"veranda_d\"\n}\nif (msg.payload.id == 0x0c){\n    name = \"cuisine_w\"\n}\nif (msg.payload.id == 0x0e){\n    name = \"buanderie_d\"\n}\nif (msg.payload.id == 0xFFFFFD){\n    name = \"salon_p\"\n}\nif (msg.payload.id == 0x555555){\n    name = \"cuisine_p\"\n}\nif (msg.payload.id == 0x3ED3D1) {\n    name = \"telco\";\n    newMsg.payload[\"status\"] = 1;\n}\n\nif (msg.payload.id == 0x3ED3D2) {\n    name = \"telco\";\n    newMsg.payload[\"status\"] = 0;\n}\n\nnewMsg.payload[\"name\"] = name;\n\nreturn newMsg;","outputs":1,"noerr":0,"x":490,"y":180,"wires":[["8e14f8d8.b7d1f8","5ab0dda7.7370bc","4ca3afd7.2f1208","8790bda0.f53648","19f1780.510f308"]]},{"id":"36506ac7.34147e","type":"serial out","z":"3405a891.bc91d8","name":"","serial":"b4cdcf58.df6728","x":710,"y":1060,"wires":[]},{"id":"20cedbc7.7b1224","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload == \"Off\"){\n    global.set('_siren_status',0);\n    msg.payload = \"10;NewKaku;FFFFFE;1;OFF\\r\\n10;NewKaku;FFFFFF;1;OFF\\r\\n\";\n}\nif (msg.payload == \"Arm Home\" || msg.payload == \"Arm Away\"){\n    msg.payload = \"10;NewKaku;FFFFFE;1;ON\\r\\n\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1060,"wires":[["36506ac7.34147e"]]},{"id":"378ca616.eda6ea","type":"serial out","z":"3405a891.bc91d8","name":"","serial":"b4cdcf58.df6728","x":1420,"y":320,"wires":[]},{"id":"235e4f5d.d9ea08","type":"function","z":"3405a891.bc91d8","name":"auto off","func":"    if (msg.payload.status == 1){\n        \n        msg.payload.status = 0;\n        return msg;\n    }\n\n","outputs":1,"noerr":0,"x":1300,"y":180,"wires":[["30a8aec8.aa222a"]]},{"id":"6bfd7098.dc8bf8","type":"inject","z":"3405a891.bc91d8","name":"","topic":"","payload":"Arm Home","payloadType":"str","repeat":"","crontab":"00 23 * * *","once":false,"onceDelay":0.1,"x":230,"y":1140,"wires":[["cc1b1b7d.3a0d38"]]},{"id":"cc1b1b7d.3a0d38","type":"function","z":"3405a891.bc91d8","name":"","func":"global.set('_alarm_status',msg.payload);\n","outputs":1,"noerr":0,"x":410,"y":1140,"wires":[[]]},{"id":"47f82709.a9a718","type":"inject","z":"3405a891.bc91d8","name":"","topic":"","payload":"Off","payloadType":"str","repeat":"","crontab":"00 06 * * *","once":false,"onceDelay":0.1,"x":210,"y":1180,"wires":[["5eb099f6.71c318"]]},{"id":"5eb099f6.71c318","type":"function","z":"3405a891.bc91d8","name":"","func":"var alarm_status = global.get('_alarm_status');\n\nif (alarm_status == \"Arm Home\")\n{\n    global.set('_alarm_status',\"Off\");\n}\n\n\n","outputs":1,"noerr":0,"x":410,"y":1180,"wires":[[]]},{"id":"96f316ed.63e0f","type":"function","z":"3405a891.bc91d8","name":"auto off","func":"if (msg.payload.name == \"escalier_p\" || msg.payload.name == \"cuisine_p\" )\n{\n  return msg;\n}","outputs":1,"noerr":0,"x":960,"y":180,"wires":[["c420094d.87431"]]},{"id":"6d421685.56de18","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Prise Chambre","tooltip":"","place":"","group":"16b61bf9.538b74","order":0,"width":0,"height":0,"passthru":true,"options":[{"label":"On","value":"10;HomeEasy;B6E3F2;1;ON","type":"str"},{"label":"Off","value":"10;HomeEasy;B6E3F2;1;OFF","type":"str"}],"payload":"","topic":"","x":580,"y":680,"wires":[["d460546.5e260a8"]]},{"id":"cab3218f.d1e36","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Lumière Chambre Eloïse","tooltip":"","place":"","group":"16b61bf9.538b74","order":0,"width":0,"height":0,"passthru":true,"options":[{"label":"On","value":"10;Kaku;0096D6B0;1;ON","type":"str"},{"label":"Off","value":"10;Kaku;0093E890;1;ON","type":"str"}],"payload":"","topic":"","x":610,"y":720,"wires":[["d460546.5e260a8"]]},{"id":"b8c681f2.2dcf1","type":"ui_dropdown","z":"3405a891.bc91d8","name":"","label":"Lumière Chambre Laetitia","tooltip":"","place":"","group":"16b61bf9.538b74","order":0,"width":0,"height":0,"passthru":true,"options":[{"label":"On","value":"10;Kaku;0099CE3C;1;ON","type":"str"},{"label":"Off","value":"10;Kaku;0090151C;1;ON","type":"str"}],"payload":"","topic":"","x":610,"y":760,"wires":[["d460546.5e260a8"]]},{"id":"2b53ba13.26e57e","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload.status == 1){\n  msg.payload = \"Open\";\n}\nelse{\n  msg.payload = \"Closed\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":500,"wires":[["c6ae1682.98c4c8"]]},{"id":"39540257.76af1e","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload.status == 1){\n  msg.payload = \"Open\";\n}\nelse{\n  msg.payload = \"Closed\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":600,"wires":[["a4ff3f07.daf11"]]},{"id":"be1cad6a.1aa228","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload.status == 1){\n  msg.payload = \"Oui\";\n}\nelse{\n  msg.payload = \"Non\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":700,"wires":[["ae44bd3b.b1532"]]},{"id":"da0d27fb.ab652","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload.status == 1){\n  msg.payload = \"Open\";\n}\nelse{\n  msg.payload = \"Closed\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":400,"wires":[["3d75af1b.b7294"]]},{"id":"62cb32a5.c4457c","type":"function","z":"3405a891.bc91d8","name":"","func":"msg.payload = msg.payload.battery;\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":440,"wires":[["9359b312.5843e"]]},{"id":"27ed0413.80175c","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload.status == 1){\n  msg.payload = \"Oui\";\n}\nelse{\n  msg.payload = \"Non\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":240,"wires":[["59251f55.2226d8"]]},{"id":"b01a6c43.340748","type":"function","z":"3405a891.bc91d8","name":"","func":"msg.payload = msg.payload.battery;\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":280,"wires":[["f705665c.ecce6"]]},{"id":"9f115b3e.62c778","type":"function","z":"3405a891.bc91d8","name":"","func":"msg.payload = msg.payload.temperature.toFixed(1);\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":320,"wires":[["21970f0e.967278","90546d28.62e7"]]},{"id":"8dd1b770.9aac8","type":"inject","z":"3405a891.bc91d8","name":"Open morning","topic":"","payload":"10;X10;000041;a;UP","payloadType":"str","repeat":"","crontab":"30 07 * * *","once":false,"onceDelay":0.1,"x":100,"y":420,"wires":[["fa99b340.89f908","e4d8e6f8.15c258"]]},{"id":"fa99b340.89f908","type":"delay","z":"3405a891.bc91d8","name":"","pauseType":"delay","timeout":"12","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":440,"wires":[["c96dbf7a.c1c3d"]]},{"id":"c96dbf7a.c1c3d","type":"function","z":"3405a891.bc91d8","name":"Stop","func":"msg.payload = \"10;X10;000041;a;STOP\";\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":440,"wires":[["e4d8e6f8.15c258"]]},{"id":"2e71fb51.796cdc","type":"sunrise","z":"3405a891.bc91d8","name":"Sunset","lat":"45.7833","lon":"3.0833","start":"sunrise","end":"sunset","soff":0,"eoff":"5","x":130,"y":480,"wires":[[],["276e319c.b596fe"]]},{"id":"276e319c.b596fe","type":"function","z":"3405a891.bc91d8","name":"Close","func":"if (msg.payload == 0)\n{\n    msg.payload = \"10;X10;000041;a;DOWN\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":410,"y":480,"wires":[["e4d8e6f8.15c258"]]},{"id":"30a8aec8.aa222a","type":"switch","z":"3405a891.bc91d8","name":"","property":"payload.name","propertyType":"msg","rules":[{"t":"eq","v":"escalier_p","vt":"str"},{"t":"eq","v":"veranda_d","vt":"str"},{"t":"eq","v":"cuisine_w","vt":"str"},{"t":"eq","v":"buanderie_d","vt":"str"},{"t":"eq","v":"salon_p","vt":"str"},{"t":"eq","v":"cuisine_p","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":1360,"y":440,"wires":[["27ed0413.80175c","b01a6c43.340748","9f115b3e.62c778"],["da0d27fb.ab652","62cb32a5.c4457c"],["2b53ba13.26e57e","4ebc4055.2945a8"],["39540257.76af1e","b322aca.90642d"],["be1cad6a.1aa228"],["362fe674.cdbde2"]]},{"id":"b322aca.90642d","type":"function","z":"3405a891.bc91d8","name":"","func":"msg.payload = msg.payload.battery;\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":640,"wires":[["ad709d72.b32ae8"]]},{"id":"ad709d72.b32ae8","type":"ui_text","z":"3405a891.bc91d8","group":"4b6fffc4.5fd3c","order":0,"width":0,"height":0,"name":"","label":"Batterie Buanderie","format":"{{msg.payload}}%","layout":"row-spread","x":1990,"y":640,"wires":[]},{"id":"4ebc4055.2945a8","type":"function","z":"3405a891.bc91d8","name":"","func":"msg.payload = msg.payload.battery;\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":540,"wires":[["1eb9280.84d31d8"]]},{"id":"1eb9280.84d31d8","type":"ui_text","z":"3405a891.bc91d8","group":"4b6fffc4.5fd3c","order":0,"width":0,"height":0,"name":"","label":"Batterie cuisine","format":"{{msg.payload}}%","layout":"row-spread","x":1980,"y":540,"wires":[]},{"id":"492c0b13.adaca4","type":"ui_text","z":"3405a891.bc91d8","group":"afedcbc7.da2c28","order":6,"width":0,"height":0,"name":"","label":"Présence cuisine","format":"{{msg.payload}}","layout":"row-spread","x":1990,"y":740,"wires":[]},{"id":"362fe674.cdbde2","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload.status == 1){\n  msg.payload = \"Oui\";\n}\nelse{\n  msg.payload = \"Non\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":740,"wires":[["492c0b13.adaca4"]]},{"id":"1ed72aca.e5ae55","type":"function","z":"3405a891.bc91d8","name":"get from context","func":"msg.payload = global.get('cuisine_p')\n\nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":740,"wires":[["362fe674.cdbde2"]]},{"id":"ad07e535.549a48","type":"inject","z":"3405a891.bc91d8","name":"","topic":"","payload":"Started!","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"","x":1340,"y":640,"wires":[["b3c037c4.d01f88","ccfed5b8.506dd","a40c997.43ee868","e267fbd0.e6044","e86fe16f.2740f","1ed72aca.e5ae55"]]},{"id":"adeacf38.e3d28","type":"ui_text","z":"3405a891.bc91d8","group":"962067ca.77b198","order":2,"width":0,"height":0,"name":"","label":"Intrusion","format":"{{msg.payload}}","layout":"row-spread","x":1100,"y":980,"wires":[]},{"id":"c8b11a91.5ecd3","type":"e-mail","z":"3405a891.bc91d8","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"etienne.mouragnon@gmail.com","dname":"email","x":1030,"y":340,"wires":[]},{"id":"8790bda0.f53648","type":"function","z":"3405a891.bc91d8","name":"test alarm","func":"if (msg.payload.status == 1){\n    \n    var alarm_status = global.get('_alarm_status');\n    \n    if (alarm_status == \"Arm Away\"){\n    \n        if (msg.payload.name == \"veranda_d\"){\n            msg.payload = \"Porte véranda ouverte\";\n            msg.topic = \"Alarme intrusion\";\n            return msg;\n        }     \n        if (msg.payload.name == \"cuisine_w\"){\n            msg.payload = \"Fenêtre cuisine ouverte\";\n            msg.topic = \"Alarme intrusion\"\n            return msg;\n        } \n        if (msg.payload.name == \"cuisine_p\"){\n            msg.payload = \"Présence cuisine\";\n            msg.topic = \"Alarme intrusion\"\n            return msg; \n        }\n        if (msg.payload.name == \"buanderie_d\"){\n            msg.payload = \"Porte buanderie ouverte\";\n            msg.topic = \"Alarme intrusion\"\n            return msg;\n        }\n        if (msg.payload.name == \"escalier_p\"){\n            msg.payload = \"Présence escalier\";\n            msg.topic = \"Alarme intrusion\"\n            return msg;\n        }\n        if (msg.payload.name == \"salon_p\") {\n            msg.payload = \"Présence salon\";\n            msg.topic = \"Alarme intrusion\"\n            return msg;\n        }\n    }\n    if (alarm_status == \"Arm Home\"){\n    \n        if (msg.payload.name == \"veranda_d\"){\n            msg.payload = \"Porte véranda ouverte\";\n            msg.topic = \"Alarme intrusion\"\n            return msg;\n        }      \n        if (msg.payload.name == \"cuisine_w\"){\n            msg.payload = \"Fenêtre cuisine ouverte\";\n            msg.topic = \"Alarme intrusion\"\n            return msg;\n        }     \n        if (msg.payload.name == \"buanderie_d\"){\n           msg.payload = \"Porte buanderie ouverte\";\n           msg.topic = \"Alarme intrusion\"\n           return msg;\n        }\n    }\n\n}\n\n","outputs":1,"noerr":0,"x":730,"y":340,"wires":[["dad3cd3d.5e7728"]]},{"id":"406251b2.28bf5","type":"debug","z":"3405a891.bc91d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":300,"wires":[]},{"id":"6f4d691e.93e34","type":"file","z":"3405a891.bc91d8","name":"","filename":"/home/pi/node-red-alarm.log","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"none","x":1460,"y":880,"wires":[["5b8ed92e.256648"]]},{"id":"e7e4837.e986b8","type":"ui_text","z":"3405a891.bc91d8","group":"9506e341.30a43","order":0,"width":"20","height":"15","name":"","label":"","format":"{{msg.payload}}","layout":"col-center","x":2050,"y":880,"wires":[]},{"id":"5b8ed92e.256648","type":"exec","z":"3405a891.bc91d8","command":"tail -n 30 /home/pi/node-red-alarm.log","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1770,"y":880,"wires":[["250c8187.5f378e","e7e4837.e986b8","fe0e8f9e.77c79"],[],[]]},{"id":"fe0e8f9e.77c79","type":"file","z":"3405a891.bc91d8","name":"","filename":"/home/pi/node-red-alarm.log","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":2080,"y":1040,"wires":[[]]},{"id":"b7508c1c.59364","type":"delay","z":"3405a891.bc91d8","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1110,"y":260,"wires":[["ba401888.96ed88"]]},{"id":"ba401888.96ed88","type":"function","z":"3405a891.bc91d8","name":"","func":"msg.payload = \"10;NewKaku;FFFFFF;1;OFF\\r\\n\"\n\nreturn msg;","outputs":1,"noerr":0,"x":1270,"y":260,"wires":[["378ca616.eda6ea"]]},{"id":"250c8187.5f378e","type":"debug","z":"3405a891.bc91d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2050,"y":960,"wires":[]},{"id":"90546d28.62e7","type":"mqtt out","z":"3405a891.bc91d8","name":"","topic":"inTemp","qos":"","retain":"","broker":"27655cfe.25e50c","x":1990,"y":360,"wires":[]},{"id":"19f1780.510f308","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload.name == \"telco\"){\n  var command = \"\";\n  if (msg.payload.status == 1){\n      command = \"Arm Away\";\n  }\n  else{\n      command = \"Off\";\n  }\n\n  msg.payload = command;\n  return msg;\n\n    \n}","outputs":1,"noerr":0,"x":100,"y":880,"wires":[["b835a5f9.5c595"]]},{"id":"dad3cd3d.5e7728","type":"delay","z":"3405a891.bc91d8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":900,"y":340,"wires":[["c8b11a91.5ecd3"]]},{"id":"cdb4a554.717748","type":"function","z":"3405a891.bc91d8","name":"","func":"if (msg.payload == \"Off\"){\n    msg.payload = \"Non\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":570,"y":980,"wires":[["adeacf38.e3d28"]]},{"id":"73bcf58f.07da5c","type":"function","z":"3405a891.bc91d8","name":"","func":"\n    msg.payload = \"Oui\";\n    return msg;\n\n\n","outputs":1,"noerr":0,"x":930,"y":920,"wires":[["adeacf38.e3d28"]]},{"id":"b4cdcf58.df6728","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"57600","databits":"8","parity":"none","stopbits":"1","waitfor":"","newline":"\\n","bin":"false","out":"char","addchar":"\\n","responsetimeout":"10000"},{"id":"779970f0.f44b78","type":"ui_group","z":"","name":"Volets","tab":"4a1932e0.9b64c4","order":1,"disp":true,"width":"6","collapse":false},{"id":"16b61bf9.538b74","type":"ui_group","z":"","name":"Lumières & Prises","tab":"4a1932e0.9b64c4","order":2,"disp":true,"width":"6","collapse":false},{"id":"7186e738.80d5a8","type":"ui_group","z":"","name":"Température","tab":"b8a78a5.fd50e78","order":2,"disp":true,"width":"6","collapse":false},{"id":"4b6fffc4.5fd3c","type":"ui_group","z":"","name":"Batteries","tab":"b8a78a5.fd50e78","order":1,"disp":true,"width":"6","collapse":false},{"id":"afedcbc7.da2c28","type":"ui_group","z":"","name":"Inputs","tab":"26d0f3f3.eb8e1c","order":2,"disp":true,"width":"6","collapse":false},{"id":"962067ca.77b198","type":"ui_group","z":"","name":"Alarm","tab":"26d0f3f3.eb8e1c","order":2,"disp":true,"width":"6","collapse":false},{"id":"9506e341.30a43","type":"ui_group","z":"","name":"Events","tab":"868cc805.d82998","order":1,"disp":true,"width":"20","collapse":false},{"id":"27655cfe.25e50c","type":"mqtt-broker","z":"","name":"","broker":"ideo-france.com","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"4a1932e0.9b64c4","type":"ui_tab","z":"","name":"Commands","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"b8a78a5.fd50e78","type":"ui_tab","z":"","name":"Service","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"26d0f3f3.eb8e1c","type":"ui_tab","z":"","name":"Home","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"868cc805.d82998","type":"ui_tab","z":"","name":"Log","icon":"dashboard","order":4,"disabled":false,"hidden":false}]